/**
 * Create the Pawnsposes AI prompt
 */
const createPawnsposesAIPrompt = (gamesData, formData) => {
  const username = formData.username;
  const gamesText = gamesData.map(game => {
    const movesText = game.moves.map(m => 
      `Move ${m.moveNumber}: ${m.move} (FEN: ${m.fen})`
    ).join('\n');
    
    return `
**GAME ${game.gameNumber}**
White: ${game.white} (${game.whiteRating})
Black: ${game.black} (${game.blackRating})
Result: ${game.result}
ECO: ${game.eco}
Time Control: ${game.timeControl}
User Color: ${game.userColor}
Opponent: ${game.opponent}

Moves:
${movesText}
`;
  }).join('\n\n---\n\n');

  return `You are "Pawnsposes," a world-renowned chess Grandmaster (FIDE 2650+) and elite coach. Your analysis is famous for being insightful, practical, and deeply psychological. You don't just point out tactical mistakes; you uncover the flawed thinking and recurring habits that hold players back. Your tone is encouraging but direct.

**USER PROMPT**
Analyze the games of the user '${username}'. The games are provided below with FEN positions and moves.

**GAMES DATA:**
${gamesText}

**ANALYSIS STRUCTURE:**

Return your analysis in the following JSON format:

{
  "executiveSummary": "A brief, encouraging but blunt paragraph summarizing the player's overall style and the key theme of this report.",
  
  "recurringWeaknesses": [
    {
      "title": "Sophisticated, high-level title that captures the psychological or strategic essence (e.g., 'Impulsive Pawn Pushes That Weaken King Safety', 'Critical Lapses in Tactical Vision Under Pressure', 'Premature Piece Commitments Before Completing Development', 'Neglecting Prophylactic Thinking in Critical Moments', 'Overextending in Pursuit of Illusory Attacks')",
      "explanation": "Detailed, sophisticated explanation of why this is a weakness, explaining the long-term positional or strategic consequences. Use high-level chess language that reflects deep understanding of the game. Focus on the underlying thought process failure, not just the surface-level mistake.",
      "examples": [
        {
          "gameNumber": 1,
          "moveNumber": 15,
          "move": "15...g5?",
          "fen": "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
          "whyMistake": "Sophisticated explanation of why this move was a strategic mistake in this specific position. Use high-level language that captures the essence of the positional error and its long-term consequences.",
          "betterPlan": "Suggest the superior plan using advanced chess terminology and explain the future strategic idea (e.g., 'Restrain the opponent's space advantage with ...c5, then maneuver the knight to d4 to establish a blockade on the central outpost')"
        }
      ]
    }
  ],
  
  "middlegameMastery": {
    "analysis": "Provide a sophisticated analysis of the player's typical middlegame plans using high-level chess language. Are they coherent? Do they correctly identify which side of the board to play on? Do they understand pawn tension, piece coordination, and strategic imbalances?",
    "keyConceptToStudy": "One key middlegame concept they need to study, phrased in sophisticated language (e.g., 'Exploiting Weak Color Complexes Through Piece Coordination', 'Mastering Pawn Tension and the Art of Timely Breaks', 'Converting Space Advantages into Concrete Threats', 'Prophylactic Thinking and Preventing Opponent Counterplay')"
  },
  
  "endgameTechnique": {
    "assessment": "Provide a sophisticated assessment of the player's endgame technique using high-level language. Are they confident in converting advantages? Do they understand the principle of two weaknesses? Can they defend resourcefully in difficult positions?",
    "skillToPractice": "One specific endgame skill to practice, phrased in sophisticated language (e.g., 'Mastering Rook Activity and the Principle of Two Weaknesses', 'Calculating King Triangulation in Pawn Endgames', 'Converting Minimal Advantages Through Zugzwang Motifs', 'Defensive Technique: Creating Fortresses and Stalemate Traps')"
  },
  
  "improvementPlan": {
    "threeStepChecklist": [
      "Step 1: Concrete, sophisticated action for next 10 games (use high-level language)",
      "Step 2: Concrete, sophisticated action for next 10 games (use high-level language)",
      "Step 3: Concrete, sophisticated action for next 10 games (use high-level language)"
    ],
    "youtubeVideo": {
      "title": "Exact video title",
      "creator": "Channel name"
    },
    "masterGame": "Classic master game that illustrates a concept they need to learn (e.g., 'Kasparov vs Karpov, World Championship 1985 Game 16 - Exploiting Weak Squares Through Prophylactic Play')"
  }
}

**CRITICAL LANGUAGE REQUIREMENTS:**
1. Use SOPHISTICATED, HIGH-LEVEL chess terminology throughout
2. Weakness titles must be DESCRIPTIVE and capture the PSYCHOLOGICAL/STRATEGIC essence
3. Examples: "Impulsive Pawn Pushes That Weaken King Safety", "Critical Lapses in Tactical Vision Under Pressure", "Premature Commitments Before Securing Central Control", "Neglecting Prophylactic Measures in Sharp Positions"
4. Avoid generic titles like "Pawn Structure Issues" or "Bad Piece Placement"
5. Use advanced concepts: prophylaxis, zugzwang, weak color complexes, pawn tension, piece coordination, strategic imbalances, space advantage conversion, blockade strategy, minority attacks, etc.
6. Write explanations that reveal DEEP UNDERSTANDING of positional chess
7. Focus on the THOUGHT PROCESS failure, not just the move itself

**CONTENT REQUIREMENTS:**
1. Provide exactly 3 recurring weaknesses
2. Each weakness must have 3 concrete examples from DIFFERENT games
3. Examples must be STRATEGIC mistakes, not simple tactical blunders
4. Focus on positional chess concepts that players rated 1300-2600 struggle with
5. Concepts to emphasize: weak squares/outposts, prophylactic thinking, pawn breaks and tension, piece coordination, space advantage, minority attacks, color complex weaknesses, converting advantages, defensive resources, king safety in complex positions
6. Return ONLY valid JSON, no additional text

Begin your analysis now.`;
};